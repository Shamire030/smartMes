<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.smartmes.mapper.ProductionExecutionMapper">
    
    <!-- 结果集映射 -->
    <resultMap id="ProductionExecutionResultMap" type="com.smartmes.model.ProductionExecution">
        <id property="id" column="id"/>
        <result property="planId" column="plan_id"/>
        <result property="productId" column="product_id"/>
        <result property="batchNo" column="batch_no"/>
        <result property="equipmentId" column="equipment_id"/>
        <result property="operatorId" column="operator_id"/>
        <result property="startTime" column="start_time"/>
        <result property="endTime" column="end_time"/>
        <result property="planQuantity" column="plan_quantity"/>
        <result property="actualQuantity" column="actual_quantity"/>
        <result property="qualifiedQuantity" column="qualified_quantity"/>
        <result property="unqualifiedQuantity" column="unqualified_quantity"/>
        <result property="status" column="status"/>
        <result property="workOrderStatus" column="work_order_status"/>
        <result property="remark" column="remark"/>
        <result property="createTime" column="create_time"/>
        <result property="updateTime" column="update_time"/>
    </resultMap>
    
    <!-- 根据ID查询 -->
    <select id="selectById" resultMap="ProductionExecutionResultMap">
        SELECT * FROM production_execution WHERE id = #{id}
    </select>
    
    <!-- 根据计划ID查询 -->
    <select id="selectByPlanId" resultMap="ProductionExecutionResultMap">
        SELECT * FROM production_execution WHERE plan_id = #{planId}
    </select>
    
    <!-- 根据批次号查询 -->
    <select id="selectByBatchNo" resultMap="ProductionExecutionResultMap">
        SELECT * FROM production_execution WHERE batch_no = #{batchNo}
    </select>
    
    <!-- 根据设备ID查询 -->
    <select id="selectByEquipmentId" resultMap="ProductionExecutionResultMap">
        SELECT * FROM production_execution WHERE equipment_id = #{equipmentId}
    </select>
    
    <!-- 根据操作员ID查询 -->
    <select id="selectByOperatorId" resultMap="ProductionExecutionResultMap">
        SELECT * FROM production_execution WHERE operator_id = #{operatorId}
    </select>
    
    <!-- 根据状态查询 -->
    <select id="selectByStatus" resultMap="ProductionExecutionResultMap">
        SELECT * FROM production_execution WHERE status = #{status}
    </select>
    
    <!-- 根据时间范围查询 -->
    <select id="selectByTimeRange" resultMap="ProductionExecutionResultMap">
        SELECT * FROM production_execution 
        WHERE start_time &gt;= #{startTime} AND start_time &lt;= #{endTime}
    </select>
    
    <!-- 查询所有 -->
    <select id="selectAll" resultMap="ProductionExecutionResultMap">
        SELECT * FROM production_execution
    </select>
    
    <!-- 插入 -->
    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO production_execution (
            plan_id, product_id, batch_no, equipment_id, operator_id,
            start_time, end_time, plan_quantity, actual_quantity, qualified_quantity,
            unqualified_quantity, status, work_order_status, remark, create_time, update_time
        ) VALUES (
            #{planId}, #{productId}, #{batchNo}, #{equipmentId}, #{operatorId},
            #{startTime}, #{endTime}, #{planQuantity}, #{actualQuantity}, #{qualifiedQuantity},
            #{unqualifiedQuantity}, #{status}, #{workOrderStatus}, #{remark}, #{createTime}, #{updateTime}
        )
    </insert>
    
    <!-- 更新 -->
    <update id="update">
        UPDATE production_execution SET
            plan_id = #{planId},
            product_id = #{productId},
            batch_no = #{batchNo},
            equipment_id = #{equipmentId},
            operator_id = #{operatorId},
            start_time = #{startTime},
            end_time = #{endTime},
            plan_quantity = #{planQuantity},
            actual_quantity = #{actualQuantity},
            qualified_quantity = #{qualifiedQuantity},
            unqualified_quantity = #{unqualifiedQuantity},
            status = #{status},
            work_order_status = #{workOrderStatus},
            remark = #{remark},
            update_time = #{updateTime}
        WHERE id = #{id}
    </update>
    
    <!-- 更新状态 -->
    <update id="updateStatus">
        UPDATE production_execution SET
            status = #{status},
            update_time = NOW()
        WHERE id = #{id}
    </update>
    
    <!-- 更新产量信息 -->
    <update id="updateProductionQuantity">
        UPDATE production_execution SET
            actual_quantity = #{actualQuantity},
            qualified_quantity = #{qualifiedQuantity},
            unqualified_quantity = #{unqualifiedQuantity},
            update_time = NOW()
        WHERE id = #{id}
    </update>
    
    <!-- 删除 -->
    <delete id="deleteById">
        DELETE FROM production_execution WHERE id = #{id}
    </delete>
</mapper>
